# Copyright 2025 Nephio Authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      http:#www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

delete_files_with_comment() {
    local comment="$1"
    local directory="$2"

    # Find all files in the directory and its subdirectories
    find "$directory" -type f -name "*.go" | while read -r file; do
        # Check if the file contains the specified comment
        if grep -qF "$comment" "$file"; then
            # Delete the file
            echo "Deleting file: $file"
            rm "$file"
        fi
    done
}

# Main script
main() {
    # Specify the comment to search for
    local conversion_gen_comment="// Code generated by conversion-gen. DO NOT EDIT."
    local client_gen_comment="// Code generated by client-gen. DO NOT EDIT."
    local informer_gen_comment="// Code generated by informer-gen. DO NOT EDIT."
    local lister_gen_comment="// Code generated by lister-gen. DO NOT EDIT."
    local openapi_gen_comment="// Code generated by openapi-gen. DO NOT EDIT."
    local webhook_gen_comment="// Code generated by webhook-gen. DO NOT EDIT."

    local directory="$(dirname "$($READLINK --canonicalize "$BASH_SOURCE")")"

    # Add all comments to a set
    local comments=("$conversion_gen_comment" "$client_gen_comment" "$informer_gen_comment" "$lister_gen_comment" "$openapi_gen_comment" "$webhook_gen_comment")

    # Delete all files with the specified comments
    for comment in "${comments[@]}"; do
        echo "Deleting files with comment: $comment"
        delete_files_with_comment "$comment" "$directory"
    done
}

main